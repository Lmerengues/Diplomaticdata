<!DOCTYPE html>
<html>
<head>
    <title>六度搜索</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
    <style type="text/css">
        html, body {
            font: 10pt arial;
        }
        #mynetwork {
            width: 600px;
            height: 600px;
            border: 1px solid lightgray;
        }
    </style>
    <script type="text/javascript" src="static/js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="static/dist/vis.js"></script>
    <script type="text/javascript" src="static/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
    <script type="text/javascript" src="static/js/bootstrap-slider.js"></script>
    <script type="text/javascript" src="static/js/jquery.dataTables.min.js"></script>
    <link href="static/dist/vis-network.min.css" rel="stylesheet" type="text/css" />
    <link  href="static/bootstrap-3.3.7-dist/css/bootstrap.css" rel="stylesheet">
    <link  href="static/bootstrap-3.3.7-dist/css/bootstrap-theme.css" rel="stylesheet">
    <link  href="static/css/slider.css" rel="stylesheet">
    <link  href="static/css/jquery.dataTables.min.css" rel="stylesheet">
</head>

<body onload="draw()">
    <div class="row">
		<div class="span6">
			<ul class="nav nav-tabs" style="margin-left:1%;">
				<li><a href="near.html?name=李克强">人际关系查询</a> </li>
				<li class="active"><a href="#">六度查询</a></li>
			</ul>
		</div>
	</div>
    <hr>
    <div id="main-container" class="container" style="margin-left: 0;margin-top:0;padding-left:0">
        <div class="row">
            <div class="col-md-8 col-sm-12 col-xs-12">
                <div class="panel panel-default">
                        <div class="panel-heading">
                        <form action="/find_path" method="get"><br>
                            <div class="row">
                                <div class="col-lg-2 col-sm-3">
                                    <input type="text" class="form-control" name="htitle" id="fname" name="p" placeholder="姓名1">
                                    <div class="errormessage"></div>
                                </div>
                                <div class="col-lg-2 col-sm-3">
                                    <input type="text" class="form-control" name="htitle" id="tname" name="p" placeholder="姓名2">
                                    <div class="errormessage"></div>
                                </div>
                                <div class="col-lg-2 col-sm-3">
                                    <input type="button" class="btn btn-default" style="" name="Submit" value="查询" id='btn-commit' />
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="panel-body">
                        <div id="mynetwork" style="width:100%;"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-sm-12 col-xs-12" >
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a class="btn btn-success"></a>
                    </div>
                    <div class="panel-body" style="" id="resultbody">
                        <div id="result">
                            <h3><span id="resulttitle">搜索结果</span></h3>
                        </div>
                    </div>
                </div>
                <!--p>result: <span id='result1'></span></p-->
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // Instantiate a slider
        var mySlider = $("input.slider").slider();

        // Call a method on the slider
        var value = mySlider.slider('getValue');

        // For non-getter methods, you can chain together commands
        mySlider
            .slider('setValue', 5)
            .slider('setValue', 7);
        // With JQuery
        $('#ex1').slider({
	        formatter: function(value) {
		    return 'Current value: ' + value;
	        }
        });

        var nodes = [];
        var edges = [];
        var network = null;
        // Horizontal slider
        $(document).ready(function(){
            //$("#resultbody").height($(window).height());
            $("#btn-commit").click(function(){
                //console.log("click");
                nodes = [];
                edges = [];
                network = [];
                var fname = $("#fname").val();
                var tname = $("#tname").val();
                $("#resulttitle").html(fname+"到"+tname+"的路径查询")
                $.get("/find_path",{'fname':fname,'tname':tname}, function(ret){
                    str = "<h3><span id='resulttitle'></span></h3><table class='table table-striped' style='width:100%' id='mytable'><thead><th>路径</th></thead><tbody>";
                    t_nodes = ret[0];
                    t_rels = ret[1];
                    t_paths = ret[2];
                     $("#resulttitle").html("in")
                    if(t_paths.length==0){
                        alert("没找到这条联系哟，是不是输错名字了？");
                        return ;
                    }
                    for(var i in t_nodes){
                        //console.log(fname);
                        //console.log(t_nodes[i]);
                        if(fname == t_nodes[i]){
                            nodes.push({id:t_nodes[i],label:t_nodes[i],color:{background:"#ff9966"}})
                        }
                        else if(tname == t_nodes[i]){
                            nodes.push({id:t_nodes[i],label:t_nodes[i],color:{background:"#33cc66"}})
                        }
                        else{
                            nodes.push({id:t_nodes[i],label:t_nodes[i]})
                        }
                    }
                    for(var i in t_paths){
                        path = ""
                        for(var j in t_paths[i]['path']){
                            if(i==0){
                                edges.push({from:t_paths[i]['path'][j]['start_node'],to:t_paths[i]['path'][j]['end_node'],value:t_paths[i]['path'][j]['val'],title:t_paths[i]['path'][j]['val'],color:{color:"#ff0000"}});
                            }
                            else{

                                edges.push({from:t_paths[i]['path'][j]['start_node'],to:t_paths[i]['path'][j]['end_node'],value:t_paths[i]['path'][j]['val'],title:t_paths[i]['path'][j]['val']});
                            }
                            //str += t_paths[i]['path'][j]['start_node'] + '--' + t_paths[i]['path'][j]['val'] + '--'
                            path += t_paths[i]['path'][j]['start_node'] + '--' + t_paths[i]['path'][j]['val'] + '--'
                        }
                        path += tname
                        str += "<tr><td>"+path+"</td></tr>"
                    }
                    str+='</tbody></table>'
                    $("#result").html(str);
                    $("#resulttitle").html(fname+"到"+tname+"的路径查询")
                    $('#mytable').DataTable({
                    "paging": true,
                    "iDisplayLength": 8, //默认每页数量
                    "bPaginate": true, //翻页功能
                    "bLengthChange": false, //改变每页显示数据数量
                    "bFilter": false, //过滤功能
                    "bInfo": true, //页脚信息
                    "bAutoWidth": true, //自动宽度
                    "bRetrieve": true,
                    "processing": true,
                    //"serverSide" : true,//服务器端进行分页处理的意思
                    //"bPaginate": true,
                    //"bProcessing": true
                    columns : [{data : "id"}],
                });
                    draw();
                })
            });
            if(window.location.href.split("=").length>1){
                ids = window.location.href.split("=")[1];
                //console.log(ids);
                ids = decodeURI(ids);
                //console.log(ids);
                if(ids.split("&").length>1){
                    //console.log(ids.split("&")[0]);
                    //console.log(ids.split("&")[1])
                    if(ids.split("&")[0]==""&&ids.split("&")[1]!=""){
                        location.href="/near?name="+ids.split("&")[1];
                    }
                    else if(ids.split("&")[1]==""&&ids.split("&")[0]!=""){
                        location.href="/near?name="+ids.split("&")[0];
                    }
                    else{
                        $("#fname").val(decodeURI(ids.split("&")[0]));
                        $("#tname").val(decodeURI(ids.split("&")[1]));
                        $('#btn-commit').trigger("click");
                    }
                }
                else{
                    if(ids!=""){
                         location.href="/near?name="+ids;
                    }
                    else{
                        $("#fname").val("扎克伯格");
                        $("#tname").val("卡扎菲");
                        $('#btn-commit').trigger("click");
                    }
                }
            }
            else{
                $("#fname").val("扎克伯格");
                $("#tname").val("卡扎菲");
                $('#btn-commit').trigger("click");
            }
    });
    function draw() {
      // create people.
      // value corresponds with the age of the person
      /*
      nodes = [
        {id: 1,  value: 2,  label: 'Algie' },
        {id: 2,  value: 31, label: 'Alston'},
        {id: 3,  value: 12, label: 'Barney'},
        {id: 4,  value: 16, label: 'Coley' },
        {id: 5,  value: 17, label: 'Grant' },
        {id: 6,  value: 15, label: 'Langdon'},
        {id: 7,  value: 6,  label: 'Lee'},
        {id: 8,  value: 5,  label: 'Merlin'},
        {id: 9,  value: 30, label: 'Mick'},
        {id: 10, value: 18, label: 'Tod'},
      ];*/
      

      // create connections between people
      // value corresponds with the amount of contact between two people
      /*
      edges = [
        {from: 2, to: 8, value: 3, title: '3 emails per week'},
        {from: 2, to: 9, value: 5, title: '5 emails per week'},
        {from: 2, to: 10,value: 1, title: '1 emails per week'},
        {from: 4, to: 6, value: 8, title: '8 emails per week'},
        {from: 5, to: 7, value: 2, title: '2 emails per week'},
        {from: 4, to: 5, value: 1, title: '1 emails per week'},
        {from: 9, to: 10,value: 2, title: '2 emails per week'},
        {from: 2, to: 3, value: 6, title: '6 emails per week'},
        {from: 3, to: 9, value: 4, title: '4 emails per week'},
        {from: 5, to: 3, value: 1, title: '1 emails per week'},
        {from: 2, to: 7, value: 4, title: '4 emails per week'}
      ];
*/
      // Instantiate our network object.
      var container = document.getElementById('mynetwork');
      var data = {
        nodes: nodes,
        edges: edges
      };
      var options = {
        nodes: {
          shape: 'dot',
          scaling:{
            label: {
              min:8,
              max:20
            }
          }
        }
      };
      network = new vis.Network(container, data, options);
    }
  </script>
</body>
</html>